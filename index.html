<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>æ½®èªä¹‹èˆŸï¼šä¸€å ´å¥‡å¹»è‡ªç„¶çš„é¢¨éšªæ—…ç¨‹</title>
<style>
  :root{
    --bg:#f4fbf6;
    --ink:#1c2b22;
    --leaf:#7cc099;
    --deep:#2f7a7a;
    --sky:#bfe7ff;
    --gold:#e7c768;
    --warn:#e86b6b;
    --card:#ffffffcc;
    --accent:#59b1a3;
    --shadow:0 10px 30px rgba(0,0,0,.08);
    --radius:16px;
  }
  *{box-sizing:border-box;}
  body{
    margin:0; font-family: "Noto Serif TC","PingFang TC",ui-serif,serif;
    color:var(--ink); background:
      radial-gradient(1200px 600px at 80% -10%, var(--sky), transparent 60%),
      radial-gradient(1000px 500px at -10% 120%, #dff7e6, transparent 50%),
      linear-gradient(#f7fff9, #eefaf3 60%, #e8f5ff);
    min-height:100dvh; display:flex; align-items:center; justify-content:center;
  }
  .app{
    width:min(1100px, 96vw);
    background:var(--
    backdrop-filter: blur(6px);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    overflow:hidden; border:1px solid #e1f0e7;
  }
  header{
    padding:16px 20px; display:flex; align-items:center; gap:12px;
    background:linear-gradient(120deg, #eafcf1, #e7f8ff);
    border-bottom:1px solid #ddf1e6;
  }
  .logo{
    width:38px; height:38px; border-radius:50%;
    background: conic-gradient(from 180deg, var(--leaf), var(--sky), var(--accent), var(--leaf));
    position:relative; box-shadow:0 2px 8px rgba(0,0,0,.06);
  }
  .logo::after{
    content:""; position:absolute; inset:6px; border-radius:50%;
    background: radial-gradient(60% 60% at 50% 40%, #fff8, #fff0);
  }
  h1{margin:0; font-size:20px; letter-spacing:.5px;}
  main{display:grid; grid-template-columns: 340px 1fr; min-height:70dvh;}
  aside{
    padding:18px; border-right:1px solid #e7efe9;
    background: linear-gradient(180deg, #f7fffb, #f3fbff 60%, #f9fffa);
  }
  .panel{background:#fff; border:1px solid #e7efe9; border-radius:14px; padding:14px; margin-bottom:14px; box-shadow: var(--shadow);}
  .attrs .bar{height:10px; background:#eef7f2; border-radius:99px; overflow:hidden; margin-top:6px;}
  .attrs .fill{height:100%; background:linear-gradient(90deg, var(--leaf), var(--accent)); width:20%; transition:width .6s cubic-bezier(.2,.8,.2,1);}
  .tag{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:99px; background:#eef9f3; color:#215a45; font-size:12px; margin:6px 6px 0 0; border:1px dashed #cfeadf}
  .scene{
    padding:26px 28px 30px 28px;
    display:flex; flex-direction:column; min-height:100%;
    background:
      radial-gradient(900px 300px at 10% 0%, #eafbf3d0, transparent 60%),
      radial-gradient(700px 250px at 90% 100%, #e8f6ffd0, transparent 60%);
  }
  .scene h2{margin:0 0 8px 0; font-size:22px}
  .scene p{line-height:1.85; font-size:16px; margin:8px 0 14px}
  .choices{display:grid; gap:12px; margin-top:auto}
  .choice{
    text-align:left; padding:14px 16px; border-radius:14px; border:1px solid #dff1e7; background:#ffffff;
    box-shadow:0 6px 18px rgba(0,0,0,.05); cursor:pointer; transition:transform .12s ease, box-shadow .2s ease, border-color .2s;
  }
  .choice:hover{transform:translateY(-2px); box-shadow:0 12px 28px rgba(0,0,0,.08); border-color:#cfe7dc}
  .choice small{display:block; color:#3c6e57; opacity:.9; margin-top:6px}
  .footer{
    display:flex; align-items:center; justify-content:space-between; padding:12px 18px; border-top:1px solid #e7efe9; background:#fbfffe
  }
  .btn{
    padding:10px 14px; border-radius:12px; border:1px solid #cfe7dc; background:linear-gradient(#fff,#f7fffb);
    cursor:pointer; transition:.2s; box-shadow:0 6px 16px rgba(0,0,0,.05);
  }
  .btn:hover{transform:translateY(-1px)}
  .toast{
    position:fixed; right:16px; bottom:16px; background:#0f5132; color:#e8fff3; padding:10px 14px; border-radius:12px; box-shadow:var(--shadow);
    opacity:0; transform:translateY(10px); pointer-events:none; transition:.35s;
  }
  .toast.show{opacity:1; transform:translateY(0)}
  .ending{
    padding:20px; background:linear-gradient(120deg,#f6fff9,#ecfbff);
  }
  .ending h3{margin:4px 0 10px 0}
  .grid{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:12px;}
  .pill{display:inline-block; padding:6px 10px; border-radius:999px; background:#eef7f2; border:1px solid #d6eee4; font-size:12px; margin:6px 6px 0 0}
  .watermark{
    position:fixed; inset:auto 12px 10px auto; font-size:12px; color:#487a6a; opacity:.6
  }
  @media (max-width:900px){
    main{grid-template-columns:1fr}
    aside{order:2}
    .scene{order:1}
  }
  /* å°äº‹ä»¶é–ƒå…‰ */
  .sparkle{position:relative}
  .sparkle::after{
    content:""; position:absolute; inset:-2px; border-radius:14px; pointer-events:none;
    background: radial-gradient(120px 40px at 0% 0%, #fff7, transparent 60%);
    animation: sheen 3.2s linear infinite;
  }
  @keyframes sheen{0%{transform:translateX(-120%)}100%{transform:translateX(120%)}}
</style>
</head>
<body>
<div class="app" id="app">
  <header>
    <div class="logo" aria-hidden="true"></div>
    <div>
      <h1>æ½®èªä¹‹èˆŸï½œå¥‡å¹»è‡ªç„¶äº’å‹•æ•˜äº‹ RPG</h1>
      <div style="font-size:12px;color:#3c6e57">ä»¥ã€Œæœªé›¨ç¶¢ç¹†ã€æ‡‰å°æœªçŸ¥ã€ç‚ºæ ¸å¿ƒå¯“æ„ï¼ˆä¸ç›´æ¥æåŠä¿éšªï¼‰</div>
    </div>
  </header>

  <main>
    <aside>
      <div class="panel">
        <strong>ä½ çš„ç‹€æ…‹</strong>
        <div class="attrs">
          <div style="margin-top:10px">å‹‡æ°£</div>
          <div class="bar"><div id="bar-c" class="fill" style="width:20%"></div></div>
          <div style="margin-top:10px">æ™ºæ…§</div>
          <div class="bar"><div id="bar-w" class="fill" style="width:20%"></div></div>
          <div style="margin-top:10px">è€åŠ›</div>
          <div class="bar"><div id="bar-s" class="fill" style="width:20%"></div></div>
          <div style="margin-top:10px">é è¦‹</div>
          <div class="bar"><div id="bar-f" class="fill" style="width:20%"></div></div>
        </div>
      </div>

      <div class="panel">
        <strong>éš¨è¡Œè­·å…· / å‚™å“</strong>
        <div id="items" style="margin-top:8px">
          <span class="tag">ï¼ å°šæœªç²å¾—</span>
        </div>
      </div>

      <div class="panel">
        <strong>æ—…ç¨‹ç´€éŒ„</strong>
        <div id="log" style="margin-top:8px; font-size:13px; line-height:1.6; color:#244b3b"></div>
      </div>
    </aside>

    <section class="scene">
      <h2 id="title">åºç« ï½œæ½®æ±æŠŠå°‘å¹´çš„åå­—ç£¨å¾—åƒä¸€ç²’å…‰</h2>
      <p id="text">
        ä½ åå«ã€Œæ³“ã€ï¼Œé›¢å²¸çš„å¤œè£¡ï¼Œæµ·éœ§åƒæ”¤é–‹çš„è‹”è¡£ã€‚æš´é¢¨ä¹‹å‰ï¼Œæ¼æ¸¯çš„é•·è€…éä¾†ä¸€åªå°æœ¨ç›’ï¼Œèªªé‚£æ˜¯ã€Œå‘æœªçŸ¥å€Ÿä¾†çš„ä¸‰å£æ°£ã€ã€‚
        ä½ å¸¶è‘—é›²è±¹å½¢çš„éˆç¸ã€Œç¥€ã€ï¼Œç‰ çš„çœ¼çœ¸æ˜ å‡ºæ˜Ÿåœ–èˆ‡æµªèŠ±ã€‚èˆ¢æ¿è¼‰æ»¿ä¹¾æœã€ç¹©ç´¢èˆ‡ä¸€ç›å¾®å…‰ç‡ˆã€‚
        è½èªªå‰æ–¹æœ‰åº§æœƒç§»å‹•çš„è«¸æ½®ç¾¤å³¶â€”â€”å®ƒå€‘åƒè‰ç±½ä¸€æ¨£æ¼‚ç§»ï¼Œæ™‚è€Œå­•è‚²æ¸…æ³‰ï¼Œæ™‚è€Œè—è‘—è£‚ç¤ã€‚
        ä½ å¯ä»¥ç«‹åˆ»å•Ÿç¨‹ï¼Œè¿½é€æµæ˜Ÿè½ä¸‹çš„ä½ç½®ï¼›ä¹Ÿèƒ½å…ˆåœ¨æ¸¯é‚Šæª¢é»ã€ä¿®è£œã€ç·´ç¿’ç¿»èˆŸï¼Œè®“è‚Œè‚‰è¨˜ä½é¢¨çš„èªæ³•ã€‚
        ã€Œç¥€ã€æŠ–è½æ°´ç ï¼Œåƒåœ¨å‚¬ä¿ƒï¼Œåˆåƒåœ¨ç­‰å¾…ä½ çš„æ±ºæ–·ã€‚
      </p>
      <div id="choices" class="choices"></div>
    </section>
  </main>

  <div class="footer">
    <button class="btn" id="backBtn" disabled>â¬… ä¸Šä¸€æ­¥</button>
    <div style="font-size:12px;color:#3b6d5a">æç¤ºï¼šæ¯æ¬¡é¸æ“‡éƒ½å°‡å½±éŸ¿ <b>å‹‡æ°£ï¼æ™ºæ…§ï¼è€åŠ›ï¼é è¦‹</b> èˆ‡å¯èƒ½ç²å¾—çš„è­·å…·ï¼Œæœ€çµ‚å°å‘ä¸åŒçµå±€ã€‚</div>
    <button class="btn" id="restartBtn">é‡æ–°é–‹å§‹ ğŸ”„</button>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>
  <div class="watermark">å¥‡å¹»è‡ªç„¶é¢¨ â€¢ è©³ç´°ç‰ˆ â€¢ å¥‡å¹»å†’éšª Ã— æº«é¦¨</div>
</div>

<script>
/* ========= è³‡æ–™æ¨¡å‹ ========= */
class State{
  constructor(){
    this.courage = 20;  // å‹‡æ°£
    this.wisdom  = 20;  // æ™ºæ…§
    this.stamina = 20;  // è€åŠ›
    this.foresight = 20;// é è¦‹
    this.items = new Set(); // ç¹©çµã€æ·¡æ°´ã€æ˜Ÿåœ–
    this.route = []; // é¸æ“‡ç´€éŒ„
    this.step = 0;   // ç›®å‰å ´æ™¯ç´¢å¼•
    this.history = []; // å ´æ™¯å †ç–Š
  }
}

class Game{
  constructor(){
    this.state = new State();
    this.scenes = this.buildScenes();
    this.ui = this.bindUI();
    this.render();
  }

  bindUI(){
    return {
      title: document.getElementById('title'),
      text: document.getElementById('text'),
      choices: document.getElementById('choices'),
      bars:{
        c: document.getElementById('bar-c'),
        w: document.getElementById('bar-w'),
        s: document.getElementById('bar-s'),
        f: document.getElementById('bar-f'),
      },
      items: document.getElementById('items'),
      log: document.getElementById('log'),
      toast: document.getElementById('toast'),
      backBtn: document.getElementById('backBtn'),
      restartBtn: document.getElementById('restartBtn')
    };
  }

  /* ---- å ´æ™¯å®šç¾©ï¼ˆ4å€‹æ±ºç­–é»ï¼‰ ---- */
  buildScenes(){
    const T = (title, text, choices)=>({title, text, choices});

    const s0 = T(
      "åºç« ï½œæ½®æ±æŠŠå°‘å¹´çš„åå­—ç£¨å¾—åƒä¸€ç²’å…‰",
      // ~450å­—å…§
      "ä½ åå«ã€Œæ³“ã€ã€‚æš´é¢¨å­£å‰å¤œï¼Œæ¸¯å…§æ½®è²åƒä¸€ç¾¤é è¡Œçš„é³¥ï¼Œå°‡æ£²æœ¨å¾ä½ å¿ƒä¸Šæ‹”èµ°ã€‚é•·è€…æŠŠä¸€åªå°æœ¨ç›’æ”¾é€²ä½ æŒå¿ƒï¼Œèªªé‚£æ˜¯ã€Œå‘æœªçŸ¥å€Ÿä¾†çš„ä¸‰å£æ°£ã€ï¼Œåªåœ¨é©æ™‚æ‰“é–‹æ‰æœƒåŒ–ä½œæ´æ‰‹ã€‚ä½ çš„åŒä¼´æ˜¯ä¸€éš»é›²è±¹å½¢éˆç¸ã€Œç¥€ã€ï¼Œç‰ çš„é¬é¬šèƒ½æ„Ÿé¢¨ï¼Œç³ä»æ˜ è‘—ç¢æ˜Ÿã€‚æœ‰äººæŒ‡å‘æµ·åœ–ä¸Šä¸€å€‹æœƒç§»å‹•çš„ç¾¤å³¶ï¼Œå®ƒå€‘æœƒåœ¨æ½®ç·šé–“æ¼‚æ³Šï¼Œæ™‚è€Œå¸¶ä¾†æ·¡æ°´ï¼Œæ™‚è€Œéœ²å‡ºé½’ç‹€ç¤ç›¤ã€‚ä½ æŠŠèˆ¢æ¿æ‹–è‡³æµªç·šï¼Œæª¢é»ä¹¾æœã€ç¹©ç´¢ã€è£œé‡˜èˆ‡å¾®å…‰ç‡ˆã€‚æ˜¯ç«‹åˆ»è¿½é€ä»Šæ™šè½æµ·çš„æµæ˜Ÿï¼Œé‚„æ˜¯å†åšå¹¾é“é å‚™å·¥ï¼šç·´ç¿»èˆŸã€æ‰“ç¹©çµã€æ¸¬å¾®å…‰ç‡ˆçš„çºŒæ˜ï¼Ÿç¥€è²¼è‘—ä½ çš„è…¿ï¼Œå‚¬ä¿ƒä¸­åˆå«è‘—ç­‰å¾…ã€‚",
      [
        {label:"ç«‹åˆ»å•Ÿç¨‹ï¼Œè¶æ½®é ­æŠ¬èµ·æ™‚è¿½ä¸Šæµæ˜Ÿå°¾è·¡", sub:"ï¼‹å‹‡æ°£ï¼Œï¼é è¦‹ï¼Œç•¥éæª¢é»", delta:{c: +8, f: -4}, next:1},
        {label:"å»¶å¾Œå‡ºèˆªï¼Œåšä¸‰ä»¶é å‚™ï¼šç¿»èˆŸæ¼”ç·´ï¼ç¹©çµï¼æ¸¬ç‡ˆ", sub:"ï¼‹æ™ºæ…§ã€ï¼‹é è¦‹ï¼Œå¯èƒ½è§¸ç™¼è­·å…·", delta:{w:+8, f:+10}, item:"ç¹©çµ", next:1},
        {label:"åªåšæœ€å°‘æª¢é»ï¼Œå¸¶ä¸Šå¤šä¸€è¢‹ä¹¾æœ", sub:"ï¼‹è€åŠ›ï¼Œï¼æ™ºæ…§", delta:{s:+8, w:-4}, next:1}
      ]
    );

    const s1 = T(
      "ç¬¬ä¸€æ½®ï½œæµªè„Šä¸Šçš„æ¼”ç®—æ³•",
      "æ±ªæ´‹åˆ°æ­£åˆæ™‚åƒä¸€å¡Šå‘¼å¸çš„ç¶ ç»ç’ƒã€‚é è™•çš„ç¾¤å³¶ç·©ç·©ç§»å‹•ï¼Œåƒè¢«çœ‹ä¸è¦‹çš„ç‰§äººè¶•è‘—ã€‚å¿½ç„¶ï¼Œé™°ç·šå¾é›²åº•å¢œä¸‹ï¼Œå¤©å…‰åœ¨æµ·é¢ä¸Šé–‹åˆã€‚ä½ æ„Ÿè¦ºåˆ°ä¸€è‚¡æ—‹è½‰çš„æµï¼Œç¥€å‰‡ä½é³´ï¼Œå°¾å·´æ‹è‘—èˆ¹æ²¿ã€‚å‰æ–¹æœ‰ä¸‰æ¢å¯è¡Œçš„è·¯ï¼šä¸€æ¢è²¼è‘—æš—ç¤ï¼Œæ½®æ±æœƒæŠŠä½ æ¨å¿«ï¼Œä½†ä¸€æ—¦æ“¦å‚·ï¼Œç”²æ¿çš„è£œé‡˜å¯èƒ½æ’ä¸ä½ï¼›ä¸€æ¢ç¹å‘èƒŒé¢¨æ°´é“ï¼Œè¿‚è¿´å»ç©©å®šï¼›é‚„æœ‰ä¸€æ¢é€šå¾€ä¸€åº§æœƒåéœ§çš„å³¶ï¼Œå³¶ä¸Šæˆ–è¨±æœ‰æ¸…æ³‰ï¼Œä¹Ÿå¯èƒ½æ˜¯æµ·å¸‚çš„é¨™è¡“ã€‚ä½ æ‘¸äº†æ‘¸å°æœ¨ç›’ï¼Œå®ƒåœ¨æŒå¿ƒè£¡åƒä¸€é¡†æœªé†’çš„å¿ƒè·³ã€‚ä½ å¿…é ˆåœ¨èµ·é¢¨ä¹‹å‰æ±ºå®šã€‚",
      [
        {label:"è²¼æš—ç¤èµ°æ·å¾‘ï¼Œè®“é€Ÿåº¦æˆç‚ºç›¾", sub:"ï¼‹å‹‡æ°£ã€ï¼‹è€åŠ›ï¼Œé¢¨éšªå¢", delta:{c:+6,s:+6, f:-3}, next:2},
        {label:"ç¹èƒŒé¢¨æ°´é“ï¼Œç´°è®€æµªç´‹èˆ‡é›²è…³", sub:"ï¼‹æ™ºæ…§ã€ï¼‹é è¦‹ï¼Œè¼ƒæ…¢", delta:{w:+7,f:+7}, item:"æ˜Ÿåœ–", next:2},
        {label:"é éœ§å³¶è£œæ°´ï¼Œé©—è­‰çœŸå‡", sub:"åˆ¤è­˜æˆåŠŸå¾—æ·¡æ°´ï¼›å¤±èª¤è€—é«”åŠ›", skillCheck:"wisdom", success:{delta:{w:+2,f:+4}, item:"æ·¡æ°´"}, fail:{delta:{s:-6}}, next:2}
      ]
    );

    const s2 = T(
      "ç¬¬äºŒæ½®ï½œèˆ‡ç¥€å…±è™•çš„ç« æ³•",
      "å¤œè£¡ï¼Œé»‘æ½®åƒä¸€æ¢é•·è›‡èœ¿èœ’è€Œéï¼Œæ˜Ÿå…‰è¢«ç‰ åäº†ä¸€ç¸·ã€‚ç¥€å¿½ç„¶è¸±åˆ°èˆ¹é ­ï¼Œç›¯è‘—ä½ çš„ä¹¾æœè¢‹ï¼Œä¼¼ä¹é£¢æ¸´ã€‚ç‰ åœ¨æµ·ä¸Šçš„æ•éŠ³æ„Ÿå®˜æ˜¯ä½ å€šè³´çš„èˆµï¼Œä½†è‹¥é£Ÿç‰©åˆ†é…å¤±è¡¡ï¼Œç‰ æœƒåœ¨æš´é¢¨ä¸­å¤±å»åˆ¤æ–·ã€‚ä½ æƒ³èµ·æ¸¯å…§çš„è€äººèªªéï¼šä»»ä½•åŒè¡Œéƒ½éœ€è¦è¦å‰‡ï¼Œè¦å‰‡æ˜¯ä¸€ç¨®çœ‹ä¸è¦‹çš„è­·å…·ã€‚æ­¤åˆ»ä½ å¯ä»¥å…¨ç„¶ä¿¡ä»»ç¥€ã€æŠŠé£Ÿç³§äº¤æ›´å¤šçµ¦ç‰ ä»¥æ›å–ç‰ çš„å°ˆæ³¨ï¼›ä¹Ÿèƒ½åš´æ ¼é…çµ¦ï¼Œç¢ºä¿é•·ç¨‹ï¼›æˆ–æ˜¯åœ¨å¤œè£¡æ•™ç‰ è¾¨èªå¾®å…‰ç‡ˆçš„ç¯€å¾‹ï¼Œè®“ä½ å€‘çš„ç¯€å¥ä¸€è‡´ã€‚æµ·é¢¨æŠŠé€™ä¸‰ç¨®å¯èƒ½å¹æˆä¸‰æœµä¸åŒçš„æµªèŠ±ï¼Œç­‰å¾…ä½ ä¼¸æ‰‹å»è§¸ç¢°ã€‚",
      [
        {label:"å„ªå…ˆé¤µé£½ç¥€ï¼Œæ›å–ç‰ åœ¨é¢¨æš´ä¸­çš„æ•éŠ³", sub:"ï¼‹å’Œè«§ï¼Œï¼‹å‹‡æ°£ï¼Œï¼è€åŠ›", delta:{c:+5,s:-5}, flag:"bondHigh", next:3},
        {label:"åš´æ ¼é…çµ¦ï¼Œè¨˜éŒ„æ¯ä¸€ç²’ä¹¾æœçš„å»å‘", sub:"ï¼‹é è¦‹ã€ï¼‹æ™ºæ…§ï¼Œé—œä¿‚é™", delta:{w:+4, f:+6}, flag:"bondLow", next:3},
        {label:"å¤œé–“è¨“ç·´ï¼šä»¥å¾®å…‰ç‡ˆç¯€å¾‹åšå”ä½œé»˜å¥‘", sub:"ï¼‹æ™ºæ…§ã€ï¼‹è€åŠ›ï¼Œæå‡ç©©å®š", delta:{w:+5, s:+5}, next:3}
      ]
    );

    const s3 = T(
      "ç¬¬ä¸‰æ½®ï½œæš´é¢¨çš„é–€æ‰‰",
      "é¢¨æš´åƒä¸€åº§å‡èµ·çš„ç»ç’ƒåŸï¼Œç‰†é¢æ˜¯æ–œæ–œçš„é›¨ã€‚æµªå³°é«˜éæœˆäº®ï¼Œèˆ¢æ¿åœ¨ç©¹é ‚èˆ‡æµ·è°·é–“è¢«æ‹‹æ“²ã€‚ä½ è½è¦‹æœ¨ç›’åœ¨ç”²æ¿è£¡å®å™¹ä½œéŸ¿ï¼Œç¥€å‰‡ç«™å¾—å¾ˆä½ï¼Œè€³æœµè²¼è‘—é¢¨ã€‚é€™ä¸€åˆ»ï¼Œä¸‰å£æ°£æˆ–è¨±è¦ç”¨ä¸Šä¸€å£ï¼šæ˜¯æ‰“é–‹æœ¨ç›’ï¼Œè®“å…¶ä¸­çš„è­·åŠ©å¼•ä¾†å¶é‡çš„å·¨é¾œæ‹–ä½ é›¢å³°ï¼Ÿé‚„æ˜¯æŠŠç¹©çµç¹«æˆæµ®ç´¢ï¼Œç¶å¥½ä½ èˆ‡ç¥€ï¼Œè®“ä»»ä½•è½æ°´éƒ½é‚„èƒ½å›åˆ°åŒä¸€æ¢ç·šï¼Ÿæˆ–ä¹¾è„†è¶é¢¨çœ¼å‡ºç¾æ™‚å¼·è¡Œè¡ç·šï¼Œè³­ä¸€å€‹é»æ˜ã€‚æ¯ä¸€æ¢è·¯éƒ½èƒ½é€šå‘å²¸ï¼Œä¹Ÿéƒ½å¯èƒ½é€šå‘å¦ä¸€å€‹æ·±è™•ã€‚ä½ çš„æŒå¿ƒç™¼ç†±ï¼ŒæµªèŠ±åœ¨çš®è†šä¸Šçˆ†é–‹å°å°çš„é¹½èŠ±ã€‚",
      [
        {label:"é–‹ç›’ç”¨ç¬¬ä¸€å£æ°£ï¼šå‘¼å–šæµ·é¾œæŒ‡å¼•è„«é›¢æµªç‰†", sub:"ï¼‹é è¦‹ã€ï¼‹æ™ºæ…§ï¼Œæ¶ˆè€—ä¸€æ¬¡è­·åŠ©", delta:{w:+4,f:+8}, useBox:true, next:"END"},
        {label:"ä»¥ç¹©çµç¹«æˆæµ®ç´¢ï¼Œç¢ºä¿å½¼æ­¤ä¸è„«é›¢", sub:"éœ€è¦æ“æœ‰ã€Œç¹©çµã€å¯å¼·åŒ–æ•ˆæœ", reqItem:"ç¹©çµ", delta:{s:+8, f:+4}, next:"END"},
        {label:"æŠ“æº–é¢¨çœ¼å¼·è¡ï¼Œåƒç®­ä¸€æ¨£ç©¿éé›¨å¹•", sub:"ï¼‹å‹‡æ°£ï¼Œé¢¨éšªå¤§", delta:{c:+8, f:-4, s:-3}, next:"END"}
      ]
    );

    return [s0,s1,s2,s3];
  }

  /* ---- éŠæˆ²ä¸»å¾ªç’° ---- */
  render(){
    const s = this.currentScene();
    if(!s){ return; }
    this.ui.title.textContent = s.title;
    this.ui.text.textContent = s.text;
    this.ui.choices.innerHTML = "";
    s.choices.forEach((ch,i)=>{
      const btn = document.createElement('button');
      btn.className = 'choice sparkle';
      btn.innerHTML = `<div>${ch.label}</div><small>${ch.sub||""}</small>`;
      btn.addEventListener('click', ()=>this.choose(ch));
      this.ui.choices.appendChild(btn);
    });
    // ç‹€æ…‹åˆ—
    this.updateBars();
    this.renderItems();
    // å°èˆª
    this.ui.backBtn.disabled = (this.state.history.length===0);
  }

  currentScene(){
    const idx = this.state.step;
    if(idx==="END"){ this.endings(); return null; }
    return this.scenes[idx];
  }

  choose(choice){
    // è¨˜éŒ„æ­·å²
    this.state.history.push(this.state.step);
    // æ•¸å€¼è®Šå‹•
    if(choice.delta){ this.applyDelta(choice.delta); }
    if(choice.item){ this.state.items.add(choice.item); this.toast(`ç²å¾—è­·å…·ï¼šã€Œ${choice.item}ã€`); }
    if(choice.flag){ this.state[choice.flag] = true; }
    if(choice.skillCheck){
      const ok = this.skillTest(choice.skillCheck);
      const outcome = ok ? choice.success : choice.fail;
      if(outcome?.delta) this.applyDelta(outcome.delta);
      if(ok && outcome?.item){ this.state.items.add(outcome.item); this.toast(`å–å¾—æ¸…æ³‰ï¼šã€Œ${outcome.item}ã€`); }
      this.log(`é€²è¡Œåˆ¤è­˜ï¼š${choice.label} â†’ ${ok?"æˆåŠŸ":"å¤±èª¤"}`);
    }else{
      this.log(`ä½ é¸æ“‡ï¼š${choice.label}`);
    }
    if(choice.useBox){ this.state.usedBox = true; }
    // å‰é€²
    this.state.step = choice.next;
    this.render();
  }

  applyDelta(d){
    const clamp=(x)=>Math.max(0, Math.min(100, x));
    this.state.courage = clamp(this.state.courage + (d.c||0));
    this.state.wisdom  = clamp(this.state.wisdom  + (d.w||0));
    this.state.stamina = clamp(this.state.stamina + (d.s||0));
    this.state.foresight = clamp(this.state.foresight + (d.f||0));
    this.updateBars(true);
  }

  updateBars(anim=false){
    const set=(el,val)=>{ el.style.width = Math.max(6,val) + "%"; };
    set(this.ui.bars.c, this.state.courage);
    set(this.ui.bars.w, this.state.wisdom);
    set(this.ui.bars.s, this.state.stamina);
    set(this.ui.bars.f, this.state.foresight);
  }

  renderItems(){
    const wrap = this.ui.items;
    wrap.innerHTML="";
    if(this.state.items.size===0){
      wrap.innerHTML = `<span class="tag">ï¼ å°šæœªç²å¾—</span>`;
      return;
    }
    this.state.items.forEach(it=>{
      const span = document.createElement('span');
      span.className="tag";
      span.textContent = it;
      wrap.appendChild(span);
    });
  }

  skillTest(type){
    const r = Math.random(); // 0~1
    let base=0.5;
    if(type==="wisdom") base = Math.min(0.85, 0.35 + this.state.wisdom/120);
    return r < base;
  }

  log(msg){
    const time = ["ğŸŒŠ","ğŸƒ","ğŸŒ¤ï¸","ğŸŒ™","â­","ğŸª¶"][Math.floor(Math.random()*6)];
    const line = document.createElement('div');
    line.textContent = `${time} ${msg}`;
    this.ui.log.prepend(line);
  }

  toast(text){
    const t = this.ui.toast;
    t.textContent = text;
    t.classList.add('show');
    clearTimeout(this.toastTimer);
    this.toastTimer = setTimeout(()=>t.classList.remove('show'), 1800);
  }

  /* ---- çµå±€è¨ˆç®—ï¼ˆâ‰¥5ç¨®ï¼‰ ---- */
  endings(){
    // æ¢ä»¶
    const {courage:c, wisdom:w, stamina:s, foresight:f, items, usedBox, bondHigh, bondLow} = this.state;

    // çµå±€æ± 
    const pool = [];

    // 1 ç†æƒ³çµå±€ï¼šå¹³è¡¡ä¸”å…·å‚™è‡³å°‘å…©æ¨£è­·å…·
    if(c>=40 && w>=40 && s>=40 && f>=40 && items.size>=2){
      pool.push({
        key:"ideal",
        title:"å’Œé¢¨æ­¸å²¸ ğŸŒˆ",
        text:"é¢¨æš´é€€å»ï¼Œé›²ç¸«åƒä¸€æ¢è¢«ç¸«å¥½çš„æ²³ã€‚ä½ èˆ‡ç¥€æ²¿è‘—æµ·é¾œç•™ä¸‹çš„å…‰ç´‹æŠµé”ä¸€åº§æ¼‚ç§»æ…¢ä¸‹ä¾†çš„å³¶ã€‚å³¶ä¸Šæœ‰é™£é¢¨æœƒæŠŠé¹½ä»½å¹é€²çŸ³æ´ï¼Œä¹¾å†·çš„æ´å£åƒä¸€å€‹å¯ä»¥ä¹…å­˜ç‰©è³‡çš„èƒ¸è…”ã€‚ä½ æŠŠç¹©çµã€æ·¡æ°´èˆ‡æ˜Ÿåœ–æ•´ç†æˆä¸‰å€‹å£è¢‹ï¼Œåƒæ˜¯çµ¦æœªä¾†çš„è‡ªå·±ç•™ä¸‹ä¸€ä»½çœ‹ä¸è¦‹çš„æŠ«é¢¨ã€‚ä½ å¿½ç„¶æ˜ç™½ï¼šçœŸæ­£çš„å‹‡æ•¢ä¸æ˜¯åªé çƒˆç„°è¡é‹’ï¼Œè€Œæ˜¯æŠŠçƒˆç„°æ”¶åœ¨ç›”ç”²åº•ä¸‹ï¼Œè®“å®ƒåœ¨éœ€è¦çš„æ™‚å€™æ°å¥½äº®èµ·ã€‚ç¥€ä½ä½åœ°å—šé³´ï¼ŒæŠŠé¡é ­è²¼å‘ä½ ã€‚ä½ å€‘æ²¿å²¸æ­å»ºåº‡è”­ï¼Œç­‰æ½®ç·šå†ç§»æ™‚ï¼Œé€™åº§å³¶æœƒå¸¶ä½ å›åˆ°æœ‰äººç…™çš„æ°´é“ã€‚ä½ åœ¨æ²™ä¸Šç•«äº†ä¸€è¡Œå­—ï¼šé å‚™ï¼Œæ˜¯æŠµé”çš„å¦ä¸€ç¨®åå­—ã€‚",
        gain:"ç²å¾—ç¨±è™Ÿï¼šæ½®ç·šè¦åŠƒè€…",
        insight:"å•Ÿç¤ºï¼šæŠŠé¢¨éšªæƒ³æˆé¢¨ï¼ŒæŠŠæº–å‚™æƒ³æˆå¸†ã€‚",
        emoji:"ğŸŒˆ"
      });
    }

    // 2 å°ˆæ¥­çµå±€ï¼šä»»å‹™æˆåŠŸä½†é—œä¿‚ç–é›¢ï¼ˆé«˜é è¦‹ã€æ™ºæ…§ï¼›bondLowï¼‰
    if((f+w)>=110 && bondLow){
      pool.push({
        key:"pro",
        title:"ç¨æŒç¾…ç›¤ ğŸ“",
        text:"ä½ ç”¨ç´°ç·»çš„é…çµ¦èˆ‡ç´€éŒ„åº¦éäº†æœ€é›£çš„å¤œã€‚æ¯ä¸€å£æ°´ã€æ¯ä¸€ç¯€é¢¨éƒ½è¢«ä½ æ‹†è§£æˆåˆ»åº¦ã€‚ä½ é †åˆ©ç¹éæš—ç¤ç¾¤ï¼Œé€²å…¥å•†èˆ¹å¸¸èµ°çš„æ°´é“ã€‚ç•¶é è™•å‚³ä¾†é˜è²ï¼Œç¥€å»æ‚„æ‚„èº²åœ¨èˆ¹å°¾ï¼Œçœ¼ç¥ä¸å†èˆ‡ä½ å°é½Šã€‚ä½ æŠµé”äº†ç‡ˆå¡”ï¼Œå»ç™¼ç¾å²¸ä¸Šçš„æŒè²åƒéš”è‘—ç»ç’ƒã€‚ä½ æ˜ç™½ï¼šè¨ˆåŠƒå¯ä»¥æŠŠèˆ¹é€åˆ°å²¸ï¼Œä½†è¦è®“å¿ƒä¹Ÿç™»é™¸ï¼Œé‚„éœ€è¦ä»–è€…çš„å‘¼å¸ã€‚ä½ æŠŠç¾…ç›¤æ›åœ¨èƒ¸å‰ï¼Œå‘Šè¨´è‡ªå·±ï¼šä¸‹æ¬¡çš„è·¯ï¼Œè®“è¦å‰‡èˆ‡é—œä¿‚ä¸€èµ·å¯«ã€‚",
        gain:"ç²å¾—æŠ€èƒ½ï¼šåº¦é‡è€…çš„ç­†è¨˜",
        insight:"å•Ÿç¤ºï¼šæŠŠé¢¨éšªæƒ³æ¸…æ¥šï¼Œä¹Ÿè¦æŠŠåŒä¼´æ”¾é€²å»ã€‚",
        emoji:"ğŸ“"
      });
    }

    // 3 å’Œè«§çµå±€ï¼šé—œä¿‚åœ“æ»¿ä½†çŠ§ç‰²ç›®æ¨™ï¼ˆé«˜ bondHighï¼Œä½é è¦‹æˆ–ç‰©è³‡ä¸è¶³ï¼‰
    if(bondHigh && (f<40 || s<35 || items.size===0)){
      pool.push({
        key:"harmony",
        title:"åŒå²¸ä¹‹æ¯ ğŸ«¶",
        text:"ä½ åˆ†çµ¦ç¥€æ›´å¤šé£Ÿç³§ï¼Œç‰ åœ¨é¢¨æš´è£¡ä»¥ç¸æ€§çš„æº–ç¢ºå®ˆä½ä½ çš„èˆ¹ã€‚æ½®ç·šè®Šæ›æ™‚ï¼Œä½ å€‘é¸æ“‡é ä¸Šä¸€åº§æœªåœ¨æ˜Ÿåœ–çš„å³¶ã€‚é‚£è£¡æœ‰æœæ¨¹ã€æ¸…æ·ºçš„æ½®æ± èˆ‡æº«æš–çš„èƒŒé¢¨ç£ï¼Œä½†è·é›¢èˆªè·¯å¾ˆé ã€‚ä½ å€‘å­¸æœƒåœ¨æ½®èµ·æ½®è½é–“æ›ä½ã€åœ¨å­£é¢¨è½‰èº«å‰æ”¶æ‹¾è‘‰ç‰‡åšçš„å±‹ã€‚é›–ç„¶æœªæŠµæ—¢å®šçš„å²¸ï¼Œä½†ä½ å€‘æŠŠå½¼æ­¤å®‰æ”¾å¾—å¾ˆå¥½ã€‚ä½ åœ¨æ²™ä¸Šåˆ»ä¸‹è¦å‰‡ï¼ŒåƒæŠŠä¸€ä»¶è¼•æŠ«é¢¨æŠ«åœ¨æœªä¾†çš„è‚©ä¸Šã€‚å¶æœ‰é èˆ¹è·¯éï¼Œä½ å·²ä¸æ€¥æ–¼æ®æ‰‹ï¼Œå› ç‚ºå¿ƒå…ˆæŠµå²¸äº†ã€‚",
        gain:"ç²å¾—ç¨±è™Ÿï¼šæ½®æ± å®ˆæœ›",
        insight:"å•Ÿç¤ºï¼šå®ˆä½å½¼æ­¤ï¼Œä¹Ÿæ˜¯ä¸€ç¨®åˆ°é”ã€‚",
        emoji:"ğŸ«¶"
      });
    }

    // 4 å£çµå±€ï¼šé­¯è½è¡ç·šï¼Œå±¬æ€§å¤±è¡¡æˆ–é«”åŠ›ä¸è¶³
    if((c>50 && f<30) || s<25){
      pool.push({
        key:"bad",
        title:"æ²‰é»˜ä¹‹æµ· ğŸŒ«ï¸",
        text:"ä½ æŠ“æº–é¢¨çœ¼å¼·è¡ï¼Œç®­çŸ¢èˆ¬çš„å‹‡æ±ºåŠƒé–‹äº†é›¨å¹•ï¼Œä¹ŸåŠƒç ´äº†èˆ¹å´åƒ…å­˜çš„è£œé‡˜ã€‚æµ·æ°´ä»¥ä¸€ç¨®è¿‘ä¹æº«æŸ”çš„æ–¹å¼æ¹§å…¥ï¼Œåƒåœ¨æé†’ä½ ï¼šæ‰€æœ‰å‹åˆ©éƒ½è¦ç•™å‡ºå›é ­çš„é–€ã€‚ç¥€è·³å…¥æ°´ä¸­æ¨è‘—èˆ¹å°¾ï¼Œä½ å€‘æ¼‚ä¸Šäº†ä¸€ç‰‡ç„¡åçš„éœæµ·ã€‚é æ–¹çš„å³¶å¶¼åƒè²¼åœ¨å¤©ä¸Šçš„å½±å­ï¼Œä¸å†é è¿‘ã€‚ä½ æŠŠå°æœ¨ç›’ç·Šæ¡ï¼Œå»å·²éŒ¯éæœ€åˆé©çš„æ™‚åˆ»ã€‚ä½ å­¸åˆ°ï¼šä¸åšæº–å‚™çš„è¡åˆºï¼Œåªæ˜¯æ¯”è¼ƒå¿«çš„åŸåœ°æ‰“è½‰ã€‚",
        gain:"å¤±å»ï¼šéƒ¨åˆ†ç‰©è³‡",
        insight:"å•Ÿç¤ºï¼šæŠŠã€Œå¦‚æœã€ææ—©è£é€²åŒ…è£¹è£¡ã€‚",
        emoji:"ğŸŒ«ï¸"
      });
    }

    // 5 éš±è—çµå±€ï¼šé›†é½Šä¸‰è­·å…·ï¼ˆç¹©çµï¼æ·¡æ°´ï¼æ˜Ÿåœ–ï¼‰æˆ–ä½¿ç”¨ã€Œä¸€å£æ°£ã€æ°åˆ°å¥½è™•ï¼‹å±¬æ€§å‡è¡¡
    const all3 = (["ç¹©çµ","æ·¡æ°´","æ˜Ÿåœ–"].every(x=>items.has(x)));
    if((all3 && (w+f)>=90 && s>=35) || (this.state.usedBox && f>=50 && w>=45)){
      pool.push({
        key:"secret",
        title:"ç¯‰å·¢ä¹‹å³¶ ğŸš",
        text:"ä½ åœ¨æš´é¢¨æœ€åšæ™‚æ‰æ‰“é–‹å°æœ¨ç›’â€”â€”ä¸æ˜¯ç‚ºäº†ä»»æ€§åœ°é€†å¤©ï¼Œè€Œæ˜¯ç‚ºäº†åœ¨æº–å‚™ä¹‹å¾Œï¼ŒæŠŠæœªçŸ¥ç´ç‚ºç›Ÿå‹ã€‚æµ·é¾œæ‡‰è²è€Œè‡³ï¼Œç‰ èƒŒç”²ä¸Šçš„è‹”è˜šåƒä¸€å¼µå¹´è¼ªçš„åœ°åœ–ã€‚ä½ ä»¥ç¹©çµæŠŠèˆ¹èˆ‡ç‰ é€£åœ¨ä¸€æ¢å‘¼å¸ç·šä¸Šï¼Œæ²¿æ˜Ÿåœ–æŠµé”ä¸€åº§ä¸­ç©ºçš„çŸ³ç°å²©å³¶ã€‚å³¶å¿ƒæœ‰ç”œæ°´ï¼Œæ´é ‚ä½è‘—æœƒåœ¨æ½®æ±æ™‚é³´å«çš„é³¥ã€‚ä½ æŠŠæ·¡æ°´å­˜æˆå°ç½ï¼Œå°‡è¦å‰‡åˆ»åœ¨çŸ³å£ï¼Œç•™çµ¦æœªä¾†å¯èƒ½ç¶“éçš„äººã€‚ä½ çµ‚æ–¼ç†è§£ï¼šçœ‹ä¸è¦‹çš„è­·å…·ï¼Œæœƒåœ¨çœ‹å¾—è¦‹çš„æ—¥å¸¸è£¡ç™¼ç”Ÿä½œç”¨ã€‚",
        gain:"ç²å¾—ç¨±è™Ÿï¼šé¢¨éšªé¦´è€…",
        insight:"å•Ÿç¤ºï¼šæœªé›¨ç¶¢ç¹†ï¼Œä½¿å¶ç„¶ä¹Ÿèƒ½æˆç‚ºæœ‹å‹ã€‚",
        emoji:"ğŸš"
      });
    }

    // é˜²å‘†ï¼šè‹¥æ²’æœ‰è§¸ç™¼ä»»ä½•ï¼Œçµ¦ä¸€å€‹ä¸­æ€§æ”¶æŸ
    if(pool.length===0){
      pool.push({
        key:"neutral",
        title:"æ½®ç·šæœªå®š ğŸª¶",
        text:"é¢¨éå¾Œï¼Œä½ èˆ‡ç¥€åœåœ¨å…©åº§å³¶ä¹‹é–“çš„æ°´é“ã€‚ä½ å­¸æœƒäº†è¨˜é¢¨ã€ç¹«ç´¢ï¼Œä¹Ÿå­¸æœƒäº†æŠŠé²ç–‘ç•¶ä½œè¨Šè™Ÿã€‚å‰æ–¹ä»æœ‰å²¸ï¼Œä½†æ­¤åˆ»ä½ é¸æ“‡åœ¨èƒŒé¢¨è™•ä¿®æ•´ï¼Œå°‡ä»Šæ—¥çš„æ•™è¨“æŠ˜æˆä¸‰ç‰‡è‘‰ï¼Œå£“é€²èˆªè¨˜æœ¬ã€‚æ˜å¤©å‡ºç™¼æ™‚ï¼Œä½ æœƒå…ˆå•è‡ªå·±ï¼šæˆ‘æº–å‚™äº†å“ªäº›è­·å…·ï¼Ÿå“ªäº›ç©ºéš™é‚„éœ€è¦è¢«ç…§é¡§ï¼Ÿä½ å¾®ç¬‘ï¼Œå› ç‚ºä½ çŸ¥é“â€”â€”é€™å°±æ˜¯è®Šå¥½çš„é–‹å§‹ã€‚",
        gain:"ç²å¾—æŠ€èƒ½ï¼šæ½®è¨˜è€…",
        insight:"å•Ÿç¤ºï¼šæŠŠæº–å‚™åšåœ¨å‰é¢ï¼ŒæŠŠéºæ†¾ç•™åœ¨å¾Œé¢ã€‚",
        emoji:"ğŸª¶"
      });
    }

    // æŒ‘é¸æœ€è²¼åˆçš„ï¼ˆå–æ¬Šé‡æœ€é«˜è€…ï¼›ç°¡åŒ–ï¼šå–ç¬¬ä¸€å€‹ï¼‰
    const end = pool[0];
    this.renderEnding(end);
  }

  renderEnding(end){
    const wrap = document.querySelector('.scene');
    const summary = `
      <div class="ending">
        <h3>${end.title}</h3>
        <p>${end.text}</p>
        <div class="grid">
          <div class="panel">
            <strong>çµç®—</strong>
            <div class="pill">å‹‡æ°£ï¼š${this.state.courage}</div>
            <div class="pill">æ™ºæ…§ï¼š${this.state.wisdom}</div>
            <div class="pill">è€åŠ›ï¼š${this.state.stamina}</div>
            <div class="pill">é è¦‹ï¼š${this.state.foresight}</div>
            <div style="margin-top:8px"><strong>è­·å…·ï¼š</strong> ${ (this.state.items.size? [...this.state.items].join("ã€") : "ï¼ˆç„¡ï¼‰") }</div>
            <div style="margin-top:8px"><strong>è·¯å¾‘æ‘˜è¦ï¼š</strong> ${this.ui.log.textContent? "è¦‹å³å´æ—…ç¨‹ç´€éŒ„" : "ä½ è¡Œæ­¢å¦‚é¢¨ï¼Œç„¡å­—å¯è¨˜"} </div>
          </div>
          <div class="panel">
            <strong>${end.gain||"æ—…ç¨‹æ”¶ç©«"}</strong>
            <p style="margin:.5em 0 0 0">ç²¾è¦ï¼š${end.insight}</p>
            <p style="opacity:.8">çµèªï¼šæœ¬æ•…äº‹ä»¥ã€Œé å‚™ã€è±¡å¾µçœ‹ä¸è¦‹çš„è­·å…·ï¼Œè®“ç©å®¶åœ¨ä¸ç›´æ¥æåŠæŸäº›ç¾å¯¦è©å½™çš„æƒ…æ³ä¸‹ï¼Œæ„Ÿå—ã€Œé¢¨éšªä¿éšœã€çš„åƒ¹å€¼ã€‚</p>
          </div>
        </div>
        <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap">
          <button class="btn" onclick="location.reload()">å†èµ°ä¸€æ®µ ${end.emoji}</button>
          <button class="btn" onclick="game.share()">è¤‡è£½æ—…ç¨‹æ‘˜è¦ ğŸ“‹</button>
        </div>
      </div>
    `;
    document.getElementById('title').textContent = "çµ‚ç« ï½œæ½®èªæ­¸æª”";
    document.getElementById('text').innerHTML = summary;
    this.ui.choices.innerHTML = "";
    this.ui.backBtn.disabled = true;
  }

  share(){
    const summary = [
      "ã€Šæ½®èªä¹‹èˆŸã€‹æ—…ç¨‹æ‘˜è¦",
      `å‹‡æ°£:${this.state.courage} æ™ºæ…§:${this.state.wisdom} è€åŠ›:${this.state.stamina} é è¦‹:${this.state.foresight}`,
      `è­·å…·:${this.state.items.size? [...this.state.items].join("ã€"):"ç„¡"}`,
      `æ—…ç¨‹ç´€éŒ„ï¼š\n${[...this.ui.log.childNodes].map(n=>"- "+n.textContent).reverse().join("\n")}`
    ].join("\n");
    navigator.clipboard.writeText(summary).then(()=>{
      this.toast("å·²è¤‡è£½æ—…ç¨‹æ‘˜è¦åˆ°å‰ªè²¼ç°¿");
    }).catch(()=>{
      this.toast("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–æ–‡å­—");
    })
  }
}

/* ========= äº‹ä»¶ç¹«çµ ========= */
const game = new Game();

document.getElementById('backBtn').addEventListener('click', ()=>{
  if(game.state.history.length===0) return;
  game.state.step = game.state.history.pop();
  game.toast("å·²å›åˆ°ä¸Šä¸€æ­¥");
  game.render();
});

document.getElementById('restartBtn').addEventListener('click', ()=>{
  const confirmReset = confirm("ç¢ºå®šè¦é‡æ–°é–‹å§‹ï¼Ÿç•¶å‰æ—…ç¨‹ç´€éŒ„å°‡æ¸…é™¤ã€‚");
  if(!confirmReset) return;
  window.location.reload();
});
</script>
</body>
</html>
